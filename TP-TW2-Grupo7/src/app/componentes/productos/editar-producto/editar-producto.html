<!-- 1. Estado de Carga (Spinner Full-Screen) -->
@if (isLoading) {
  <div class="loading-overlay">
    <div class="spinner"></div>
  </div>
} @else {
  <!-- Contenedor del Formulario -->
  <div class="container mx-auto p-4 max-w-lg">
    <h2 class="text-3xl font-bold mb-6 text-gray-800">Editar Producto</h2>

    <form [formGroup]="form" (ngSubmit)="guardar()" class="bg-white p-8 rounded-lg shadow-md space-y-6">

      <!-- Campo Nombre -->
      <div>
        <label for="nombre" class="block text-sm font-medium text-gray-700 mb-1">Nombre del producto</label>
        <input type="text" id="nombre" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" formControlName="nombre">
        @if (form.get('nombre')?.invalid && (form.get('nombre')?.touched || form.get('nombre')?.dirty)) {
          <p class="text-red-500 text-xs mt-1">El nombre es requerido.</p>
        }
      </div>

      <!-- Campo Descripción -->
      <div>
        <label for="descripcion" class="block text-sm font-medium text-gray-700 mb-1">Descripción</label>
        <textarea id="descripcion" rows="4" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" formControlName="descripcion"></textarea>
        @if (form.get('descripcion')?.invalid && (form.get('descripcion')?.touched || form.get('descripcion')?.dirty)) {
          <p class="text-red-500 text-xs mt-1">La descripción es requerida.</p>
        }
      </div>

      <!-- Campo Clasificación -->
      <div>
        <label for="clasificacion" class="block text-sm font-medium text-gray-700 mb-1">Clasificación</label>
        <input type="text" id="clasificacion" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" formControlName="clasificacion">
        @if (form.get('clasificacion')?.invalid && (form.get('clasificacion')?.touched || form.get('clasificacion')?.dirty)) {
          <p class="text-red-500 text-xs mt-1">La clasificación es requerida.</p>
        }
      </div>

      <!-- Campo Precio -->
      <div>
        <label for="precio" class="block text-sm font-medium text-gray-700 mb-1">Precio</label>
        <input type="number" id="precio" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" formControlName="precio">
        @if (form.get('precio')?.errors?.['required'] && (form.get('precio')?.touched || form.get('precio')?.dirty)) {
          <p class="text-red-500 text-xs mt-1">El precio es requerido.</p>
        }
        @if (form.get('precio')?.errors?.['min'] && (form.get('precio')?.touched || form.get('precio')?.dirty)) {
          <p class="text-red-500 text-xs mt-1">El precio debe ser mayor a 0.</p>
        }
      </div>

      <!-- Campo Imagen (seleccionar archivo) -->
<div class="flex items-center gap-4">

  <!-- Vista previa -->
  <div>
    @if (form.get('imagen')?.value) {
      <img
        [src]="form.get('imagen')?.value"
        alt="Vista previa"
        class="h-32 w-32 object-cover rounded shadow-md"
      >
    } @else {
      <div class="h-32 w-32 bg-gray-200 rounded flex items-center justify-center text-gray-500">
        Sin imagen
      </div>
    }
  </div>

  <!-- Botón para seleccionar archivo -->
  <div>
    <label
      for="imagenInput"
      class="cursor-pointer bg-blue-600 text-white px-3 py-1 rounded shadow hover:bg-blue-700 inline-block"
    >
      Cambiar imagen
    </label>

    <!-- Input oculto -->
    <input
      id="imagenInput"
      type="file"
      accept="image/*"
      (change)="onFileSelected($event)"
      class="hidden"
    >
  </div>

</div>



      <!-- Botones -->
      <div class="flex items-center gap-4">
        <button type="submit" [disabled]="form.invalid" class="bg-green-600 text-white px-6 py-2 rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed">
          Guardar Cambios
        </button>
      <button
  type="button"
  (click)="cancelar()"
  class="text-gray-600 hover:text-gray-900">
  Cancelar
</button>

      </div>

      <!-- Mensaje de Feedback -->
      @if (mensaje) {
        <div class="p-4 rounded-md" [ngClass]="{
          'bg-green-100 border border-green-400 text-green-700': tipoMensaje === 'success',
          'bg-yellow-100 border border-yellow-400 text-yellow-700': tipoMensaje === 'warning',
          'bg-red-100 border border-red-400 text-red-700': tipoMensaje === 'error'
        }">
          <p>{{ mensaje }}</p>
        </div>
      }
    </form>
  </div>
}
