<div class="container mx-auto p-4 md:p-8">
  <h1 class="text-3xl font-bold text-white mb-8">
    ðŸ›’ Tu Carrito de Compras
  </h1>
  <div *ngIf="(items$ | async) as items; else carritoVacio">
    <div *ngIf="items.length > 0; else carritoVacio" class="lg:grid lg:grid-cols-3 lg:gap-8">
      <div class="lg:col-span-2 space-y-6">

        <div *ngFor="let item of items" class="bg-slate-800 rounded-lg shadow-lg overflow-hidden flex">
          <img
            [src]="item.producto.imagen ? item.producto.imagen : 'https://placehold.co/200x200/eeeeee/999999?text=' + item.producto.nombre"
            class="w-40 h-40  object-cover flex-shrink-0" (error)="imgErrorCarrito($event, item.producto.nombre)">
          <div class="p-4 sm:p-6 flex flex-col justify-between flex-grow">
            <div>
              <h2 class="text-lg sm:text-xl font-bold text-white">{{ item.producto.nombre }}</h2>

              <p class="text-gray-400 text-sm mt-1">
                Precio: <span class="text-white">{{ item.producto.precio | currency:'$' }}</span>
              </p>

              <div class="flex items-center mt-3">
                <span class="text-gray-400 text-sm mr-3">Cantidad:</span>

                <button (click)="decrementar(item.producto.id!)"
                  class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-1 px-3 rounded-md transition-colors"
                  aria-label="Restar uno">
                  -
                </button>

                <span class="text-white font-medium mx-2 text-lg">{{ item.cantidad }}</span>

                <button (click)="incrementar(item.producto)"
                  class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-1 px-3 rounded-md transition-colors"
                  aria-label="Sumar uno">
                  +
                </button>
              </div>
            </div>
            <div class="flex justify-between items-end mt-2">

              <button
                class="text-sm text-center bg-red-600 text-white font-semibold py-2 px-2 rounded-lg shadow-md hover:bg-red-700 transition-colors"
                (click)="eliminar(item.producto.id!)">
                Quitar
              </button>

              <div class="flex flex-col items-end">
                <span class="text-sm text-gray-400">Subtotal</span>
                <span class="text-xl sm:text-2xl font-semibold text-white">
                  {{ (item.producto.precio * item.cantidad) | currency:'$' }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="lg:col-span-1 mt-8 lg:mt-0 lg:sticky lg:top-8">
        <div class="bg-slate-800 rounded-lg shadow-lg p-6">
          <h2 class="text-2xl font-bold text-white border-b border-slate-700 pb-4 mb-4">
            Resumen de compra
          </h2>

          <div class="space-y-3">
            <div class="flex justify-between text-gray-300">
              <span>Total Productos</span>
              <span>{{ total$ | async | currency:'$' }}</span>
            </div>
            <div class="flex justify-between text-gray-300">
              <span>EnvÃ­o</span>
              <span class="text-green-500 font-medium">Gratis</span>
            </div>
          </div>

          <div class="border-t border-slate-700 mt-4 pt-4">
            <div class="flex justify-between items-center text-white font-bold text-xl">
              <span>Total a Pagar</span>
              <span>{{ total$ | async | currency:'$' }}</span>
            </div>
          </div>

          <button
            class="mt-6 w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 transition-colors text-lg"
            (click)="continuarCompra()"> Continuar Compra
          </button>

          <a routerLink="/productos"
            class="mt-4 w-full text-center bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-gray-700 transition-colors text-lg inline-block">
            Seguir Comprando
          </a>
        </div>
      </div>
    </div>
  </div>

  <ng-template #carritoVacio>
    <div class="p-4 bg-blue-800 border border-blue-600 text-white rounded-lg shadow-lg mt-8">
      <h3 class="font-bold text-xl mb-2">Â¡Ups!</h3>
      Tu carrito estÃ¡ vacÃ­o.
      <a routerLink="/productos" class="font-medium text-blue-300 hover:text-blue-200 transition-colors ml-2">Ver
        productos</a>
    </div>
  </ng-template>
</div>